# Mihomo Despicable Infiltrator - åŠŸèƒ½è§„åˆ’

æœ¬æ–‡æ¡£è®°å½•å³å°†å¼€å‘çš„æ‰˜ç›˜èœå•å¢å¼ºåŠŸèƒ½ã€‚

---

## åŠŸèƒ½ 1ï¼šé…ç½®æ–‡ä»¶å¿«é€Ÿåˆ‡æ¢

**ç›®æ ‡**ï¼šåœ¨æ‰˜ç›˜èœå•ä¸­ç›´æ¥åˆ‡æ¢å·²ä¸‹è½½çš„é…ç½®æ–‡ä»¶ï¼Œæ— éœ€æ‰“å¼€é…ç½®ç®¡ç†ç•Œé¢ã€‚

### å®ç°è®¡åˆ’ï¼šé…ç½®åˆ‡æ¢

- [x] **åç«¯å‡†å¤‡**ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰
  - å·²æœ‰ APIï¼š`POST /admin/api/profiles/switch`ï¼ˆ`admin_api.rs:280-290`ï¼‰
  - å·²æœ‰ APIï¼š`GET /admin/api/profiles`ï¼ˆ`admin_api.rs:255-262`ï¼‰
  - å·²æœ‰å‡½æ•°ï¼š`core_profiles::list_profile_infos()`

- [x] **æ‰˜ç›˜èœå•æ”¹é€ **ï¼ˆ`src-tauri/src/tray.rs`ï¼‰
  - [x] åœ¨ `build_tray_menu()` ä¸­æ·»åŠ "é…ç½®åˆ‡æ¢"å­èœå•
  - [x] åŠ¨æ€è¯»å–é…ç½®åˆ—è¡¨ï¼Œä¸ºæ¯ä¸ªé…ç½®åˆ›å»º CheckMenuItem
  - [x] æ ‡è®°å½“å‰æ´»è·ƒé…ç½®ï¼ˆ`active: true`ï¼‰
  - [x] é…ç½®æ•°é‡ > 10 æ—¶æŠ˜å ä¸ºâ€œæ›´å¤šé…ç½®â€å­èœå•
  - [x] æ·»åŠ èœå•é¡¹ ID å‘½åè§„èŒƒï¼š`profile-switch-{name}`

- [x] **äº‹ä»¶å¤„ç†**ï¼ˆ`src-tauri/src/tray.rs:271-419`ï¼‰
  - [x] åœ¨ `on_menu_event` ä¸­æ·»åŠ  `profile-switch-*` åŒ¹é…é€»è¾‘
  - [x] ç›´æ¥åˆ‡æ¢å½“å‰é…ç½®å¹¶é‡è½½è¿è¡Œæ—¶ï¼ˆç­‰ä»· `/profiles/switch` + `rebuild_runtime`ï¼‰
  - [x] åˆ‡æ¢æˆåŠŸåè°ƒç”¨ `rebuild_runtime()` é‡è½½é…ç½®
  - [x] å¤±è´¥æ—¶å¼¹å‡º `show_error_dialog`
  - [x] æˆåŠŸååˆ·æ–°æ‰˜ç›˜èœå• `refresh_tray_menu()`

- [x] **çŠ¶æ€åŒæ­¥**ï¼ˆ`src-tauri/src/app_state.rs`ï¼‰
  - [x] é€šè¿‡ `list_profile_infos()` ç›´æ¥è¯»å–å½“å‰æ´»è·ƒé…ç½®ï¼Œæ— éœ€é¢å¤–ç¼“å­˜
  - [x] åœ¨ `refresh_tray_menu` é‡å»ºèœå•æ—¶æ›´æ–°æ´»è·ƒé…ç½®å‹¾é€‰çŠ¶æ€

### æŠ€æœ¯è¦ç‚¹ï¼šé…ç½®åˆ‡æ¢

- åˆ‡æ¢é…ç½®æ—¶éœ€ç­‰å¾…ç«¯å£é‡Šæ”¾ï¼ˆå‚è€ƒ `restart-admin` é€»è¾‘ï¼Œ`tray.rs:348-352`ï¼‰
- é‡ç”¨ç°æœ‰çš„ `rebuild_runtime()` æµç¨‹ï¼Œé¿å…é‡å¤ä»£ç 
- é…ç½®åˆ—è¡¨æ’åºï¼šæ´»è·ƒé…ç½®ç½®é¡¶ï¼Œå…¶ä½™æŒ‰åç§°å­—å…¸åº

### é¢„æœŸæ•ˆæœï¼šé…ç½®åˆ‡æ¢

ç”¨æˆ·å³é”®æ‰˜ç›˜ â†’ "é…ç½®åˆ‡æ¢" â†’ é€‰æ‹©"å·¥ä½œé…ç½®" â†’ è‡ªåŠ¨é‡è½½ mihomoï¼Œæ— éœ€æ‰“å¼€æµè§ˆå™¨ã€‚

---

## åŠŸèƒ½ 2ï¼šæ¨¡å¼/ç­–ç•¥å¿«é€Ÿåˆ‡æ¢

**ç›®æ ‡**ï¼šä¸€é”®åˆ‡æ¢ mihomo è¿è¡Œæ¨¡å¼ï¼ˆç›´è¿/è§„åˆ™/å…¨å±€/è„šæœ¬ï¼‰ï¼Œæ— éœ€ä¿®æ”¹é…ç½®æ–‡ä»¶ã€‚

### å®ç°è®¡åˆ’ï¼šæ¨¡å¼åˆ‡æ¢

- [x] **mihomo API å°è£…**ï¼ˆ`mihomo-rs/src/core/client.rs`ï¼‰
  - [x] æ·»åŠ æ–¹æ³• `patch_config(&self, updates: serde_json::Value) -> Result<()>`
  - [x] è°ƒç”¨ `PATCH /configs` APIï¼ˆæ–‡æ¡£ï¼š<https://wiki.metacubex.one/api/#/default/patchConfigsï¼‰>
  - [x] æ”¯æŒä¿®æ”¹ `mode` å­—æ®µï¼š`{"mode": "rule"}`

- [x] **Runtime æ‰©å±•**ï¼ˆ`crates/despicable-infiltrator-core/src/runtime.rs`ï¼‰
  - [x] æ·»åŠ æ–¹æ³• `set_mode(&self, mode: &str) -> Result<()>`
  - [x] è°ƒç”¨ä¸Šè¿° `MihomoClient::patch_config()`
  - [x] æ”¯æŒçš„æ¨¡å¼ï¼š`rule`ï¼ˆè§„åˆ™ï¼‰ã€`global`ï¼ˆå…¨å±€ï¼‰ã€`direct`ï¼ˆç›´è¿ï¼‰ã€`script`ï¼ˆè„šæœ¬ï¼‰

- [x] **æ‰˜ç›˜èœå•æ”¹é€ **ï¼ˆ`src-tauri/src/tray.rs`ï¼‰
  - [x] æ·»åŠ "ä»£ç†æ¨¡å¼"å­èœå•ï¼ŒåŒ…å« 4 ä¸ª CheckMenuItemï¼š
    - `mode-rule`ï¼š"è§„åˆ™æ¨¡å¼"
    - `mode-global`ï¼š"å…¨å±€ä»£ç†"
    - `mode-direct`ï¼š"ç›´è¿æ¨¡å¼"
    - `mode-script`ï¼š"è„šæœ¬æ¨¡å¼"ï¼ˆè‹¥é…ç½®ä¸­æœªå¯ç”¨è„šæœ¬åˆ™ç¦ç”¨ï¼‰
  - [x] ä» mihomo è¯»å–å½“å‰æ¨¡å¼å¹¶å‹¾é€‰å¯¹åº”é¡¹

- [x] **AppState æ‰©å±•**ï¼ˆ`src-tauri/src/app_state.rs`ï¼‰
  - [x] æ·»åŠ  `current_mode: Arc<Mutex<Option<String>>>`
  - [x] æ·»åŠ æ–¹æ³• `update_mode_text(&self, mode: &str)`
  - [x] èœå•æ„å»ºæ—¶åˆ·æ–°æ¨¡å¼çŠ¶æ€

- [x] **äº‹ä»¶å¤„ç†**ï¼ˆ`src-tauri/src/tray.rs:271-419`ï¼‰
  - [x] åŒ¹é… `mode-*` äº‹ä»¶
  - [x] è°ƒç”¨ `runtime.set_mode()` åˆ‡æ¢æ¨¡å¼
  - [x] æˆåŠŸåæ›´æ–°æ‰˜ç›˜çŠ¶æ€ï¼Œå¤±è´¥æ—¶å¼¹å‡ºé”™è¯¯æç¤º
  - [x] æ— éœ€ `rebuild_runtime()`ï¼Œmihomo æ”¯æŒçƒ­æ›´æ–°

### æŠ€æœ¯è¦ç‚¹ï¼šæ¨¡å¼åˆ‡æ¢

- `PATCH /configs` éœ€è¦æ„é€  JSON bodyï¼š`{"mode": "global"}`
- å½“å‰æ¨¡å¼å¯é€šè¿‡ `GET /configs` è·å–ï¼Œä½†è¯¥ API è¿”å›å®Œæ•´é…ç½®ï¼ˆè¾ƒå¤§ï¼‰ï¼Œå»ºè®®åœ¨æ‰˜ç›˜èœå•æ‰“å¼€æ—¶è°ƒç”¨ä¸€æ¬¡
- å¯èƒ½éœ€è¦åœ¨ `mihomo-rs/src/core/types.rs` æ·»åŠ  `ConfigResponse` ç»“æ„ä½“

### é¢„æœŸæ•ˆæœï¼šæ¨¡å¼åˆ‡æ¢

ç”¨æˆ·å³é”®æ‰˜ç›˜ â†’ "ä»£ç†æ¨¡å¼" â†’ "å…¨å±€ä»£ç†" â†’ mihomo å®æ—¶åˆ‡æ¢ï¼Œæ— éœ€é‡å¯å†…æ ¸ã€‚

---

## åŠŸèƒ½ 3ï¼šä»£ç†ç»„èŠ‚ç‚¹é€‰æ‹©

**ç›®æ ‡**ï¼šåœ¨æ‰˜ç›˜èœå•ä¸­ç›´æ¥é€‰æ‹©ä»£ç†ç»„ï¼ˆå¦‚ Proxyã€Fallbackï¼‰çš„å‡ºç«™èŠ‚ç‚¹ã€‚

### å®ç°è®¡åˆ’ï¼šèŠ‚ç‚¹é€‰æ‹©

- [x] **mihomo API å°è£…**ï¼ˆå·²å®Œæˆï¼Œæ— éœ€ä¿®æ”¹ï¼‰
  - å·²æœ‰æ–¹æ³•ï¼š`get_proxies(&self) -> Result<HashMap<String, ProxyInfo>>`ï¼ˆ`client.rs:47-56`ï¼‰
  - å·²æœ‰æ–¹æ³•ï¼š`switch_proxy(&self, group: &str, proxy: &str) -> Result<()>`ï¼ˆ`client.rs:66-79`ï¼‰

- [x] **æ‰˜ç›˜èœå•æ”¹é€ **ï¼ˆ`src-tauri/src/tray.rs`ï¼‰
  - [x] æ·»åŠ "ä»£ç†ç»„"å­èœå•
  - [x] åŠ¨æ€è¯»å– `GET /proxies` è¿”å›çš„ä»£ç†ç»„ï¼ˆ`proxy_type` ä¸º `Selector`/`URLTest`/`Fallback` ç­‰ï¼‰
  - [x] ä¸ºæ¯ä¸ªä»£ç†ç»„åˆ›å»ºå­èœå•ï¼Œå±•ç¤º `all` å­—æ®µä¸­çš„èŠ‚ç‚¹åˆ—è¡¨
  - [x] å½“å‰é€‰ä¸­èŠ‚ç‚¹ï¼ˆ`now` å­—æ®µï¼‰æ ‡è®°å‹¾é€‰çŠ¶æ€
  - [x] èŠ‚ç‚¹æ˜¾ç¤ºå»¶è¿Ÿä¿¡æ¯ï¼ˆå¯é€‰ï¼Œä» `history` è¯»å–æœ€è¿‘ä¸€æ¬¡å»¶è¿Ÿï¼‰
  - [x] èœå•é¡¹ ID å‘½åï¼š`proxy-{group_name}-{node_name}`

- [x] **äº‹ä»¶å¤„ç†**ï¼ˆ`src-tauri/src/tray.rs:271-419`ï¼‰
  - [x] åŒ¹é… `proxy-*` äº‹ä»¶ï¼Œè§£æå‡º `group_name` å’Œ `node_name`
  - [x] è°ƒç”¨ `runtime.switch_proxy(group, node)`
  - [x] æˆåŠŸååˆ·æ–°æ‰˜ç›˜èœå•ï¼Œå¤±è´¥æ—¶å¼¹å‡ºé”™è¯¯
  - [x] æ— éœ€é‡å¯å†…æ ¸ï¼Œmihomo æ”¯æŒçƒ­åˆ‡æ¢

- [x] **AppState æ‰©å±•**ï¼ˆ`src-tauri/src/app_state.rs`ï¼‰
  - [x] æ·»åŠ  `proxy_groups: Arc<Mutex<HashMap<String, ProxyInfo>>>` ç¼“å­˜ä»£ç†ç»„ä¿¡æ¯
  - [x] æ·»åŠ æ–¹æ³• `refresh_proxy_groups(&self)` å®šæœŸæˆ–æ‰‹åŠ¨åˆ·æ–°
  - [x] èœå•æ„å»ºæ—¶è§¦å‘åˆ·æ–°

- [x] **æ€§èƒ½ä¼˜åŒ–**ï¼ˆå¯é€‰ï¼‰
  - [x] ä»£ç†ç»„æ•°é‡ > 5 æ—¶ï¼Œä»…æ˜¾ç¤ºå‰ 5 ä¸ªå¸¸ç”¨ç»„ï¼Œå…¶ä½™æŠ˜å åˆ°"æ›´å¤šä»£ç†ç»„"å­èœå•
  - [x] èŠ‚ç‚¹æ•°é‡ > 10 æ—¶ï¼Œåˆ†é¡µæ˜¾ç¤ºæˆ–ä»…æ˜¾ç¤ºå»¶è¿Ÿ < 1000ms çš„èŠ‚ç‚¹

### æŠ€æœ¯è¦ç‚¹ï¼šèŠ‚ç‚¹é€‰æ‹©

- `GET /proxies` è¿”å›æ‰€æœ‰ä»£ç†ä¿¡æ¯ï¼ˆåŒ…æ‹¬èŠ‚ç‚¹å’Œä»£ç†ç»„ï¼‰ï¼Œéœ€è¿‡æ»¤å‡º `proxy_type` ä¸º `Selector` ç­‰å¯é€‰æ‹©çš„ç»„
- `all` å­—æ®µåŒ…å«è¯¥ç»„å¯é€‰çš„æ‰€æœ‰èŠ‚ç‚¹åç§°ï¼Œ`now` å­—æ®µä¸ºå½“å‰é€‰ä¸­èŠ‚ç‚¹
- å»¶è¿Ÿä¿¡æ¯åœ¨ `history` æ•°ç»„ä¸­ï¼Œæ ¼å¼ï¼š`[{"time": "...", "delay": 100}, ...]`ï¼Œå–æœ€æ–°ä¸€æ¡

### é¢„æœŸæ•ˆæœï¼šèŠ‚ç‚¹é€‰æ‹©

ç”¨æˆ·å³é”®æ‰˜ç›˜ â†’ "ä»£ç†ç»„" â†’ "Proxy" â†’ "é¦™æ¸¯èŠ‚ç‚¹ 01 (120ms)" â†’ ç«‹å³åˆ‡æ¢å‡ºç«™èŠ‚ç‚¹ã€‚

---

## åŠŸèƒ½ 4ï¼šTUN æ¨¡å¼å¼€å…³

**ç›®æ ‡**ï¼šåœ¨æ‰˜ç›˜èœå•ä¸­ä¸€é”®å¯ç”¨/ç¦ç”¨ TUN æ¨¡å¼ï¼ˆè™šæ‹Ÿç½‘å¡é€æ˜ä»£ç†ï¼‰ã€‚

### å®ç°è®¡åˆ’ï¼šTUN æ¨¡å¼

- [x] **mihomo API å°è£…**ï¼ˆ`mihomo-rs/src/core/client.rs`ï¼‰
  - [x] æ‰©å±• `patch_config()` æ–¹æ³•æ”¯æŒä¿®æ”¹ `tun.enable` å­—æ®µ
  - [x] ç¤ºä¾‹è¯·æ±‚ä½“ï¼š`{"tun": {"enable": true}}`
  - [x] æ³¨æ„ï¼šmihomo å¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™æ‰èƒ½å¯ç”¨ TUNï¼ˆå·²åœ¨æ‰˜ç›˜ä¸­æ£€æµ‹ï¼‰

- [x] **æ‰˜ç›˜èœå•æ”¹é€ **ï¼ˆ`src-tauri/src/tray.rs`ï¼‰
  - [x] åœ¨"è®¾ç½®"å­èœå•ä¸­æ·»åŠ  CheckMenuItemï¼š`tun-mode`ï¼š"TUN æ¨¡å¼"
  - [x] å¯ç”¨æ¡ä»¶ï¼š
    - å½“å‰ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œï¼ˆ`is_running_as_admin() == true`ï¼‰
    - é…ç½®æ–‡ä»¶ä¸­åŒ…å« `tun` å­—æ®µï¼ˆéœ€æ£€æµ‹ï¼‰
  - [x] éç®¡ç†å‘˜æ—¶æ˜¾ç¤ºä¸º"TUN æ¨¡å¼ï¼ˆéœ€ç®¡ç†å‘˜ï¼‰"å¹¶ç¦ç”¨

- [x] **é…ç½®æ£€æµ‹**ï¼ˆ`mihomo-rs/src/core/client.rs`ï¼‰
  - [x] æ·»åŠ æ–¹æ³• `get_config(&self) -> Result<ConfigResponse>`
  - [x] è°ƒç”¨ `GET /configs` è·å–å½“å‰å®Œæ•´é…ç½®
  - [x] æ£€æŸ¥ `tun` å­—æ®µæ˜¯å¦å­˜åœ¨åŠ `enable` çŠ¶æ€

- [x] **AppState æ‰©å±•**ï¼ˆ`src-tauri/src/app_state.rs`ï¼‰
  - [x] æ·»åŠ  `tun_enabled: Arc<Mutex<bool>>`
  - [x] æ·»åŠ æ–¹æ³• `refresh_tun_state(&self)` è¯»å–å½“å‰ TUN çŠ¶æ€
  - [x] åœ¨ `refresh_tray_menu` ä¸­è°ƒç”¨æ›´æ–°å‹¾é€‰çŠ¶æ€

- [x] **äº‹ä»¶å¤„ç†**ï¼ˆ`src-tauri/src/tray.rs:271-419`ï¼‰
  - [x] åŒ¹é… `tun-mode` äº‹ä»¶
  - [x] æ£€æŸ¥ç®¡ç†å‘˜æƒé™ï¼Œéç®¡ç†å‘˜æ—¶æç¤º"éœ€è¦ç®¡ç†å‘˜æƒé™"
  - [x] è°ƒç”¨ `runtime.patch_config({"tun": {"enable": !current_state}})`
  - [x] æˆåŠŸååˆ·æ–°æ‰˜ç›˜çŠ¶æ€ï¼Œå¤±è´¥æ—¶å¼¹å‡ºé”™è¯¯
  - [x] å¯èƒ½éœ€è¦è°ƒç”¨ `reload_config()` ä½¿é…ç½®ç”Ÿæ•ˆï¼ˆéœ€éªŒè¯ mihomo è¡Œä¸ºï¼‰

### æŠ€æœ¯è¦ç‚¹ï¼šTUN æ¨¡å¼

- Windows TUN é©±åŠ¨éœ€ç®¡ç†å‘˜æƒé™ï¼Œå¯ç”¨å‰å¿…é¡»æ£€æµ‹ `is_running_as_admin()`
- `PATCH /configs` ä¿®æ”¹ `tun.enable` åå¯èƒ½éœ€è¦ `PUT /configs?force=true` é‡è½½ï¼ˆæ ¹æ® mihomo æ–‡æ¡£ç¡®è®¤ï¼‰
- é…ç½®æ–‡ä»¶ä¸­æœªå®šä¹‰ `tun` å­—æ®µæ—¶ï¼Œæ— æ³•é€šè¿‡ API å¯ç”¨ï¼Œéœ€æç¤ºç”¨æˆ·æ‰‹åŠ¨æ·»åŠ é…ç½®
- å¯é€‰åŠŸèƒ½ï¼šTUN å¯ç”¨æ—¶åœ¨æ‰˜ç›˜å›¾æ ‡ä¸Šå åŠ å°å›¾æ ‡ï¼ˆå¦‚ç›¾ç‰Œï¼‰ï¼Œæé†’ç”¨æˆ·å½“å‰ä¸ºå…¨å±€é€æ˜ä»£ç†

### é¢„æœŸæ•ˆæœï¼šTUN æ¨¡å¼

ç”¨æˆ·å³é”®æ‰˜ç›˜ â†’ "è®¾ç½®" â†’ "TUN æ¨¡å¼" â†’ å‹¾é€‰ â†’ mihomo å¯ç”¨è™šæ‹Ÿç½‘å¡ï¼Œæ‰€æœ‰æµé‡è‡ªåŠ¨ä»£ç†ã€‚

---

## åŠŸèƒ½ 5ï¼šè®¢é˜…è‡ªåŠ¨æ›´æ–°è®¡åˆ’

**ç›®æ ‡**ï¼šä¸ºå¯¼å…¥çš„è®¢é˜…é…ç½®è®¾ç½®å®šæ—¶åˆ·æ–°ï¼ˆå¦‚æ¯ 12 å°æ—¶ï¼‰ï¼Œåå°è‡ªåŠ¨æ›´æ–°èŠ‚ç‚¹ä¿¡æ¯ã€‚

### å®ç°è®¡åˆ’ï¼šè®¢é˜…æ›´æ–°

- [x] **æ•°æ®æ¨¡å‹æ‰©å±•**ï¼ˆ`crates/despicable-infiltrator-core/src/profiles.rs`ï¼‰
  - [x] åœ¨ `ProfileInfo` ä¸­æ·»åŠ å­—æ®µï¼š
    - `subscription_url: Option<String>`ï¼šè®¢é˜…é“¾æ¥
    - `auto_update_enabled: bool`ï¼šæ˜¯å¦å¯ç”¨è‡ªåŠ¨æ›´æ–°
    - `update_interval_hours: Option<u32>`ï¼šæ›´æ–°é—´éš”ï¼ˆå°æ—¶ï¼‰
    - `last_updated: Option<chrono::DateTime<Utc>>`ï¼šä¸Šæ¬¡æ›´æ–°æ—¶é—´
    - `next_update: Option<chrono::DateTime<Utc>>`ï¼šä¸‹æ¬¡æ›´æ–°æ—¶é—´
  - [x] åœ¨ `mihomo-rs/src/config/manager.rs` çš„ `Profile` ç»“æ„ä½“ä¸­æ·»åŠ ä¸Šè¿°å­—æ®µ
  - [x] æŒä¹…åŒ–åˆ° `~/.config/mihomo-rs/config.toml`ï¼ˆæ‰©å±• `Config` ç»“æ„ä½“ï¼‰

- [x] **è®¢é˜…å…ƒæ•°æ®å­˜å‚¨**ï¼ˆ`mihomo-rs/src/config/manager.rs`ï¼‰
  - [x] åœ¨è®¢é˜…å¯¼å…¥/æ›´æ–°æ—¶å†™å…¥è®¢é˜… URL ä¸æ›´æ–°é…ç½®
  - [x] æ·»åŠ æ–¹æ³• `update_profile_metadata()` æ›´æ–°è®¢é˜…ä¿¡æ¯
  - [x] æ·»åŠ æ–¹æ³• `get_profile_metadata()` è¯»å–è®¢é˜…ä¿¡æ¯

- [x] **å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨**ï¼ˆæ–°å»º `crates/despicable-infiltrator-core/src/scheduler.rs`ï¼‰
  - [x] å®ç° `SubscriptionScheduler` ç»“æ„ä½“
  - [x] ä½¿ç”¨ `tokio::time::interval` æ¯ 1 å°æ—¶æ£€æŸ¥ä¸€æ¬¡æ˜¯å¦æœ‰éœ€è¦æ›´æ–°çš„è®¢é˜…
  - [x] æ£€æŸ¥é€»è¾‘ï¼š`next_update <= now && auto_update_enabled == true`
  - [x] è°ƒç”¨è®¢é˜…æ›´æ–°é€»è¾‘ï¼ˆå¤ç”¨ `import_profile_http` çš„ä¸‹è½½é€»è¾‘ï¼‰
  - [x] æ›´æ–°æˆåŠŸåä¿®æ”¹ `last_updated` å’Œ `next_update`ï¼Œè‹¥å½“å‰é…ç½®æ´»è·ƒåˆ™è‡ªåŠ¨é‡è½½

- [x] **åç«¯é›†æˆ**ï¼ˆ`src-tauri/src/main.rs`ï¼‰
  - [x] åœ¨åº”ç”¨å¯åŠ¨æ—¶åˆå§‹åŒ– `SubscriptionScheduler`
  - [x] å°†è°ƒåº¦å™¨å­˜å‚¨åˆ° `AppState`
  - [x] åº”ç”¨é€€å‡ºæ—¶ä¼˜é›…å…³é—­è°ƒåº¦å™¨

- [x] **Admin API æ‰©å±•**ï¼ˆ`crates/despicable-infiltrator-core/src/admin_api.rs`ï¼‰
  - [x] æ·»åŠ è·¯ç”±ï¼š`POST /admin/api/profiles/:name/subscription` è®¾ç½®è®¢é˜…é…ç½®
  - [x] æ·»åŠ è·¯ç”±ï¼š`DELETE /admin/api/profiles/:name/subscription` å–æ¶ˆè®¢é˜…
  - [x] æ·»åŠ è·¯ç”±ï¼š`POST /admin/api/profiles/:name/update-now` ç«‹å³æ‰‹åŠ¨æ›´æ–°è®¢é˜…
  - [x] è¯·æ±‚ä½“ç¤ºä¾‹ï¼š

    ```json
    {
      "url": "https://example.com/sub",
      "auto_update_enabled": true,
      "update_interval_hours": 12
    }
    ```

- [x] **å‰ç«¯ UI æ”¹é€ **ï¼ˆ`config-manager-ui/src/components/ProfilesPanel.vue`ï¼‰
  - [x] é…ç½®åˆ—è¡¨ä¸­æ˜¾ç¤ºè®¢é˜…å›¾æ ‡ï¼ˆè‹¥æœ‰è®¢é˜… URLï¼‰
  - [x] æ˜¾ç¤º"ä¸‹æ¬¡æ›´æ–°æ—¶é—´"ï¼ˆå¦‚"2 å°æ—¶å"ï¼‰
  - [x] æ·»åŠ "ç«‹å³æ›´æ–°"æŒ‰é’®
  - [x] åœ¨é…ç½®è¯¦æƒ…ä¸­æ·»åŠ "è®¢é˜…è®¾ç½®"æŠ˜å é¢æ¿ï¼š
    - å¯ç”¨è‡ªåŠ¨æ›´æ–°å¼€å…³
    - æ›´æ–°é—´éš”é€‰æ‹©å™¨ï¼ˆ12h/24h/48h/7dï¼‰
    - æ˜¾ç¤ºè®¢é˜… URLï¼ˆè„±æ•æ˜¾ç¤ºï¼Œå¦‚ `https://****/sub`ï¼‰
    - æ˜¾ç¤ºä¸Šæ¬¡æ›´æ–°æ—¶é—´

- [x] **æ‰˜ç›˜èœå•æ”¹é€ **ï¼ˆ`src-tauri/src/tray.rs`ï¼Œå¯é€‰ï¼‰
  - [x] åœ¨"é…ç½®åˆ‡æ¢"å­èœå•ä¸­ä¸ºè®¢é˜…é…ç½®æ·»åŠ "ğŸ”„"æ ‡è®°
  - [x] æ·»åŠ "ç«‹å³æ›´æ–°æ‰€æœ‰è®¢é˜…"èœå•é¡¹
  - [x] æ›´æ–°æ—¶æ˜¾ç¤ºé€šçŸ¥ï¼š"æ­£åœ¨æ›´æ–°è®¢é˜…..."

- [x] **é€šçŸ¥æœºåˆ¶**ï¼ˆ`src-tauri/src/app_state.rs`ï¼‰
  - [x] è®¢é˜…æ›´æ–°æˆåŠŸæ—¶å‘é€ç³»ç»Ÿé€šçŸ¥ï¼š"é…ç½® 'å·¥ä½œè®¢é˜…' å·²æ›´æ–°"
  - [x] æ›´æ–°å¤±è´¥æ—¶å‘é€é€šçŸ¥ï¼š"è®¢é˜…æ›´æ–°å¤±è´¥: ç½‘ç»œé”™è¯¯"
  - [x] ä½¿ç”¨ Tauri çš„ `Notification` API

### æŠ€æœ¯è¦ç‚¹ï¼šè®¢é˜…æ›´æ–°

- è®¢é˜… URL å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼ˆtokenï¼‰ï¼Œéœ€åŠ å¯†å­˜å‚¨æˆ–è„±æ•æ˜¾ç¤º
- æ›´æ–°æ—¶éœ€è¦é˜²æ­¢é‡å¤æ›´æ–°ï¼ˆåŠ é”æˆ–çŠ¶æ€æ ‡è®°ï¼‰
- è‹¥æ´»è·ƒé…ç½®æ­£åœ¨æ›´æ–°ï¼Œéœ€è°¨æ…å¤„ç†é‡è½½æ—¶æœºï¼ˆå¯ç­‰å¾…ç©ºé—²æˆ–ç”¨æˆ·ç¡®è®¤ï¼‰
- è€ƒè™‘æ·»åŠ "æ›´æ–°å¤±è´¥é‡è¯•"é€»è¾‘ï¼ˆæœ€å¤šé‡è¯• 3 æ¬¡ï¼ŒæŒ‡æ•°é€€é¿ï¼‰
- è°ƒåº¦å™¨éœ€å¤„ç†ç³»ç»Ÿä¼‘çœ /å”¤é†’åœºæ™¯ï¼ˆWindows å¯èƒ½é”™è¿‡å®šæ—¶ä»»åŠ¡ï¼‰

### é¢„æœŸæ•ˆæœï¼šè®¢é˜…æ›´æ–°

ç”¨æˆ·åœ¨é…ç½®ç®¡ç†ç•Œé¢å¯¼å…¥è®¢é˜…åï¼Œå‹¾é€‰"è‡ªåŠ¨æ›´æ–°ï¼ˆæ¯ 12 å°æ—¶ï¼‰"ï¼Œåç»­æ— éœ€æ‰‹åŠ¨æ“ä½œï¼Œç³»ç»Ÿåå°æ¯ 12 å°æ—¶è‡ªåŠ¨æ‹‰å–æœ€æ–°èŠ‚ç‚¹ä¿¡æ¯ã€‚

---

## å¼€å‘ä¼˜å…ˆçº§å»ºè®®

1. **åŠŸèƒ½ 1ï¼šé…ç½®æ–‡ä»¶å¿«é€Ÿåˆ‡æ¢**ï¼ˆä½éš¾åº¦ï¼Œé«˜ä»·å€¼ï¼Œå¯å¿«é€ŸéªŒè¯æ‰˜ç›˜èœå•æ‰©å±•æµç¨‹ï¼‰
2. **åŠŸèƒ½ 2ï¼šæ¨¡å¼/ç­–ç•¥å¿«é€Ÿåˆ‡æ¢**ï¼ˆä¸­éš¾åº¦ï¼Œé«˜ä»·å€¼ï¼Œéœ€æ‰©å±• mihomo API å°è£…ï¼‰
3. **åŠŸèƒ½ 3ï¼šä»£ç†ç»„èŠ‚ç‚¹é€‰æ‹©**ï¼ˆä¸­éš¾åº¦ï¼Œé«˜ä»·å€¼ï¼ŒUI å¤æ‚åº¦è¾ƒé«˜ï¼‰
4. **åŠŸèƒ½ 4ï¼šTUN æ¨¡å¼å¼€å…³**ï¼ˆä¸­éš¾åº¦ï¼Œä¸­ä»·å€¼ï¼Œéœ€å¤„ç†æƒé™æ£€æµ‹ï¼‰
5. **åŠŸèƒ½ 5ï¼šè®¢é˜…è‡ªåŠ¨æ›´æ–°è®¡åˆ’**ï¼ˆé«˜éš¾åº¦ï¼Œä¸­é«˜ä»·å€¼ï¼Œéœ€æ–°å¢è°ƒåº¦å™¨å’ŒæŒä¹…åŒ–é€»è¾‘ï¼‰

---

## è¡¥å¼ºä»»åŠ¡

- [x] è®¢é˜…æ›´æ–°é˜²é‡å¤/å¹¶å‘é”å®šï¼ˆé¿å…å¤šæ¬¡æ›´æ–°é‡å…¥ï¼‰
- [x] è®¢é˜…æ›´æ–°å¤±è´¥é‡è¯•ï¼ˆæœ€å¤š 3 æ¬¡ï¼ŒæŒ‡æ•°é€€é¿ï¼‰
- [x] æ´»è·ƒé…ç½®æ›´æ–°æ—¶çš„é‡è½½æ—¶æœºä¼˜åŒ–ï¼ˆåˆå¹¶ä¸ºå•æ¬¡é‡è½½ï¼‰
- [x] ç³»ç»Ÿä¼‘çœ /å”¤é†’åçš„æ›´æ–°è¡¥å¿ç­–ç•¥
- [x] è®¢é˜… URL åŠ å¯†å­˜å‚¨ï¼ˆæ¨è DPAPI/OS keychainï¼‰

## æŠ€æœ¯å€ºåŠ¡ä¸é£é™©

- **æ‰˜ç›˜èœå•åˆ·æ–°æ€§èƒ½**ï¼šåŠ¨æ€èœå•é¡¹è¿‡å¤šï¼ˆå¦‚ 20+ èŠ‚ç‚¹ï¼‰å¯èƒ½å¯¼è‡´å¡é¡¿ï¼Œéœ€æµ‹è¯•å¹¶ä¼˜åŒ–
- **mihomo API å…¼å®¹æ€§**ï¼š`PATCH /configs` åœ¨ä¸åŒ mihomo ç‰ˆæœ¬ä¸­çš„è¡Œä¸ºå¯èƒ½ä¸ä¸€è‡´ï¼Œéœ€éªŒè¯
- **è®¢é˜…æ›´æ–°å¤±è´¥å¤„ç†**ï¼šç½‘ç»œé”™è¯¯ã€è®¢é˜…å¤±æ•ˆç­‰åœºæ™¯éœ€è¦å®Œå–„çš„é”™è¯¯æç¤º
- **å¤šçº¿ç¨‹å®‰å…¨**ï¼š`AppState` ä¸­æ–°å¢çš„ `Mutex` å­—æ®µéœ€é¿å…æ­»é”ï¼ˆå°¤å…¶æ˜¯ `refresh_tray_menu` è°ƒç”¨é“¾ï¼‰
- **é…ç½®æ–‡ä»¶æ ¼å¼**ï¼šè®¢é˜…å…ƒæ•°æ®å­˜å‚¨åœ¨ `config.toml` ä¸­ï¼Œéœ€å¤„ç†æ—§ç‰ˆæœ¬è¿ç§»

---

## æµ‹è¯•è®¡åˆ’

- [ ] æ‰‹åŠ¨æµ‹è¯•æ‰€æœ‰æ‰˜ç›˜èœå•äº¤äº’ï¼ˆåˆ‡æ¢é…ç½®ã€åˆ‡æ¢æ¨¡å¼ã€é€‰æ‹©èŠ‚ç‚¹ã€å¼€å…³ TUNï¼‰
- [ ] æµ‹è¯•ç®¡ç†å‘˜/éç®¡ç†å‘˜æƒé™ä¸‹çš„è¡Œä¸ºå·®å¼‚
- [ ] æµ‹è¯•è®¢é˜…æ›´æ–°çš„è¾¹ç•Œåœºæ™¯ï¼ˆæ— ç½‘ç»œã€è®¢é˜…å¤±æ•ˆã€æ´»è·ƒé…ç½®æ­£åœ¨ä½¿ç”¨ï¼‰
- [ ] æ€§èƒ½æµ‹è¯•ï¼š100+ èŠ‚ç‚¹åœºæ™¯ä¸‹çš„æ‰˜ç›˜èœå•å“åº”é€Ÿåº¦
- [ ] å›å½’æµ‹è¯•ï¼šç¡®ä¿æ–°åŠŸèƒ½ä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼ˆç³»ç»Ÿä»£ç†ã€å†…æ ¸æ›´æ–°ã€æ¢å¤å‡ºå‚è®¾ç½®ç­‰ï¼‰

---

## æ–‡æ¡£æ›´æ–°

å®Œæˆåéœ€æ›´æ–°ä»¥ä¸‹æ–‡æ¡£ï¼š

- [x] `README.md`ï¼šæ·»åŠ æ–°åŠŸèƒ½è¯´æ˜ä¸æˆªå›¾
- [x] `CHANGELOG.md`ï¼šè®°å½•ç‰ˆæœ¬å˜æ›´
- [x] `USAGE_SPEC.md`ï¼šè¡¥å……è®¢é˜…é…ç½®æ–‡ä»¶æ ¼å¼è¯´æ˜
- [x] æœ¬æ–‡ä»¶ï¼ˆ`TODO.md`ï¼‰ï¼šæ ‡è®°å®ŒæˆçŠ¶æ€
