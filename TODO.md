# Mihomo Despicable Infiltrator - 功能规划

本文档记录即将开发的托盘菜单增强功能。

---

## 托盘菜单重构计划

**目标**：优化托盘菜单的视觉分组，提升用户体验，并补全缺失的功能开关和信息展示。

### 分组规划

1.  **Group 1: 连接状态**
    *   静态站点: ...
    *   控制接口: ...
    *   配置管理: ...
2.  **Group 2: 权限与重启**
    *   管理员权限: ...
    *   以管理员身份重启
    *   恢复出厂设置
3.  **Group 3: 功能开关与 UI 入口**
    *   内核管理 (子菜单)
    *   设置 (子菜单 - 含开机自启、TUN)
    *   系统代理 (开关)
    *   打开浏览器
    *   打开配置管理
4.  **Group 4: Mihomo 运行时控制 (需连接成功)**
    *   代理模式 (子菜单)
    *   配置切换 (子菜单 - 含自动更新开关)
    *   代理组 (子菜单)
5.  **Group 5: 关于与退出**
    *   关于 (子菜单 - 含版本信息)
    *   退出

### 待办任务

- [ ] **托盘菜单分组重构**
  - [ ] 使用 `PredefinedMenuItem::separator()` 添加分隔线
  - [ ] 按照新的分组逻辑重新排列菜单项

- [ ] **自动更新订阅开关**
  - [ ] 在"配置切换"子菜单底部添加 `[ ] 自动更新当前订阅` 开关
  - [ ] 仅当当前活跃配置有订阅 URL 时显示
  - [ ] 点击切换 `auto_update_enabled` 状态并持久化

- [ ] **关于菜单**
  - [ ] 添加"关于"子菜单
  - [ ] 展示 App 版本 (Cargo.toml)
  - [ ] 展示 mihomo-rs 版本 (硬编码/Cargo.toml)
  - [ ] 展示 Core 版本 (运行时获取)

- [ ] **代理组获取优化**
  - [ ] 优化 `refresh_proxy_groups` 失败时的日志
  - [ ] 在托盘打开时增加重试逻辑或延迟获取，避免启动初期获取失败

---

## 已完成功能 (归档)

- [x] **配置文件快速切换**
  - 后端 API 支持，托盘菜单动态生成，事件处理完善。
- [x] **模式/策略快速切换**
  - API 封装完成，托盘菜单支持四种模式切换。
- [x] **代理组节点选择**
  - API 封装完成，动态生成节点列表子菜单。
- [x] **TUN 模式开关**
  - API 封装完成，托盘菜单权限检测与开关逻辑完成。
- [x] **订阅自动更新计划**
  - 数据模型扩展，调度器实现，后端集成与 Admin API 扩展完成。
  - 前端 UI 支持订阅设置与立即更新。
  - 托盘菜单支持"立即更新所有订阅"。
- [x] **订阅更新补强**
  - 防重复更新，失败重试，更新时重载优化，系统休眠补偿，URL 加密存储。