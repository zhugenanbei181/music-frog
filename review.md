# 整改评审记录

## 目标

- 保持现有功能与行为不变。
- 逐步拆分核心逻辑，降低维护成本。
- 所有改动均可追溯、可验证。

## 约束

- Tauri 只负责托盘与壳层，核心业务逻辑可抽离复用。
- 不引入破坏性行为或未经验证的重构。

## 规划

1. 审视当前业务流程与潜在风险点。
2. 先补齐关键校验与运行时稳定性问题。
3. 在同一 crate 内按模块拆分逻辑（不改外部行为）。
4. 编译验证与回归检查。
5. 评估独立 crate 迁移清单。

## 执行记录

- TODO：应用启动时会短暂弹出 cmd 窗口（影响美观），待测试结果确认后一起优化。
- TODO：订阅导入与激活解耦，导入快速返回，激活改为异步并展示重启进度，避免长时间卡住。
- TODO：配置管理界面体验升级，评估用现代前端框架（如 Vue）重构为构建产物并继续按静态资源打包。
- 已完成：保存/导入配置的 YAML 校验，避免坏配置导致内核启动失败。
- 已完成：运行时重建后自动刷新系统代理端口，防止端口漂移。
- 已完成：MihomoRuntime抽离到 core crate，Tauri 改用公用实现。
- 已完成：系统代理/内核解析迁移至 `despicable-infiltrator-core`，并移除 Tauri 内重复实现。
- 已完成：ProfileInfo/ProfileDetail 与基础配置查询迁移到 core crate。
- 已完成：统一 YAML 校验入口，核心版本排序逻辑与 UI 一致。
- 已完成：admin API 与配置管理服务迁移至 core crate（Tauri 仅注入上下文）。
- 已完成：核心逻辑模块抽离完毕，Tauri 仅保留托盘和路径解析等边界交互。
- 已完成：Tauri 主逻辑拆分为 `tray/runtime/frontend/settings/paths/platform/utils/autostart/system_proxy/core_update` 等模块。
- 已完成：移除平台相关的 unsafe 调用，Windows 相关能力改用安全库封装。
- 已完成：移除代码中的 `\u{}` 转义，统一用可读中文文案。

## 验证策略

- 变更后执行 `cargo test`（`src-tauri/`）。
- 对托盘与配置管理的关键流程做手动回归（启动/保存/切换/更新/重启）。
